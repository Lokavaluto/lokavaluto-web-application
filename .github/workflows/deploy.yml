name: "ðŸš€ deploy CI"
on:
  push:
    branches:
      - demo
      - test
      - dev1
      - dev2
      - dev3
    paths-ignore:
      - 'README*'

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    steps:
      - name: ðŸšš Get code
        uses: actions/checkout@v2
      - name: ðŸšš Get node
        uses: actions/setup-node@v2
        with:
          node-version: 14.x
      - name: ðŸšš Get deps
        run: |
          npm install
      - name: ðŸ”¨ Config
        run: |
          rm public/config.sample.json
          echo "{
            \"lokapiDb\": \"odoo\",
            \"lokapiHost\": \"dev3.lokavaluto.fr\",
            \"mapUrl\": \"https://carte.dev3.lokavaluto.fr\",
            \"localPasswordRetentionTime\": 900,
            \"logoUrl\": \"https://monujo.${GITHUB_REF_NAME}.lokavaluto.fr/img/logo.png\"
            \"theme\": {
              \"color-1\": \"#E4F2F1\",
              \"color-2\": \"#009688\",
              \"color-3\": \"#F0FAF9\",
              \"inner-card-border-color\": \"#F0FAF9\",
              \"inner-card-background-color\": \"#F0FAF9\",
              \"btn-recharger-text-color\": \"#009688\",
              \"btn-recharger-border-color\": \"#009688\",
              \"btn-recharger-background-color\": \"#FFFFFF\",
              \"btn-login-text-color\": \"#FFFFFF\",
              \"btn-login-border-color\": \"#009688\",
              \"btn-login-background-color\": \"#009688\"
            }
          }" > public/config.json
          cat public/config.json
      - name: ðŸ”¨ Build
        run: |
          npm run build
      - name: "ðŸ“‚ SFTP Sync files"
        uses: swillner/sftp-sync-action@v1.0
        with:
          server: ${{ github.ref_name }}.lokavaluto.fr
          port: 10322
          user: monujo
          user_private_key: ${{ secrets.sftp_private_key }}
          host_public_key:
          local: ./dist/
          remote: /monujo
          mirror_options: "--verbose"